---
title: "電子ペーパーを使って"やさしい"IoTサイネージを作った！"
emoji: "🐕"
type: "tech" 
topics:
  - "soracom"
  - "iot"
  - "awssam"
published: false
---

本記事は[SORACOM Advent Calendar 2023](https://qiita.com/advent-calendar/2023/soracom)の21日目の記事です。

私は毎年12月に「SORACOMを使って○○を作ってみた」という記事を投稿することを習慣にしています。
早いもので今年も4回目となりました。過去の製作物もぜひ見ていただけると幸いです。

- [ソラカメを使って「寝坊した自分がライブ配信されるIoTシステム」を作った！](https://qiita.com/Y_uuu/items/f69015a41b3dff9bfee0) (2022年)
- [SORACOMとM5Stackを使ってポケベルを現代に復刻させた](https://zenn.dev/y_uuu/articles/aac958991e8cb6) (2021年)
- [SOSした同僚を確実にお助けするためのIoTパトランプを作った](https://qiita.com/Y_uuu/items/9c781f269167d73ee262) (2020年)

----

今年作ったのはタイトルにもあるとおり「"やさしい"IoTサイネージ」です :tada:

![](電子ペーパーサイネージの写真)

## 背景

私が所属する株式会社Fusicでは、[Fusic Tech Live](https://fusic.connpass.com/) を始めとする技術イベントを定期開催しています。
イベントの開催はSlackで社内にも共有されるのですが、Slackには様々な通知が来るので埋もれがちで、記憶にも残りにくいと感じています。

そこで、もっと視覚的に訴えかけることができ印象に残る通知方法として、IoTサイネージを制作することにしました。

![](別アングルの電子ペーパーサイネージ)

## ソリューション

まずイベントの情報をどこから取得してくるかを検討しました。

開催されるイベントの多くはconnpassで告知しますが、一部connpassで募集していないイベントもあります。
社内向けにはOutlookカレンダーに予定が登録されているので、ここから予定を取得して表示するという方法が考えられます。

![](Outlook予定表)

ただし、Outlook予定表の中にはIoTサイネージに投影できないものもあるため、今回は決められたプレフィックスが付与されている予定のみを投影する仕様としています。

取得したイベントの予定はMQTTでデバイスに送信します。
今回はWi-Fi通信がある場所にサイネージを設置しましたが、今後Wi-Fi通信がない場所に設置する可能性もゼロではないため、LTE通信に切り替える余地も残したいです。
そこで、今回はSORACOM Arcを使ってSORACOM Beam経由でAWSと接続することにしました。

![](システム構成図)

## 製作

### デバイス

#### ハードウェア

サイネージとして使えるサイズの電子ペーパーとなると、その時点で候補がかなり絞られます。
4インチの7色電子ペーパーである*Inky Impression 4"*が、Web上での製作事例も多く、Raspberry Piと直接接続して使えるのでこちらを使用しました。

- Inky Impression 4" 
  - https://www.switch-science.com/products/8135

この時点でデバイスの制御はRaspberry Piを使用することが確定します。たまたま手元に3が1台余っていたのでこれを使用します。
3でも問題なく動作していますし、今となっては5も登場しているのですが、現時点で最も入手しやすいものでいうと4かもしれません。

- Raspberry Pi 4(2GB)
  - https://www.switch-science.com/products/5680

#### ソフトウェア

Inky Impression 4"はPythonで書かれた[サンプルプログラム](https://github.com/pimoroni/inky/blob/main/examples/7color/image.py)がGitHubに公開されています。
画像ファイルをライブラリに入力することで描画できるようになっているので、Fusicのロゴが入った画像ファイルを用意しておき、そこにMQTT経由で受信したイベントの情報を文字として埋め込み、その画像を出力しています。

![](文字埋め込み前の画像)

![](文字埋め込み後の画像)

クラウドとの通信は [soratun](https://github.com/soracom/soratun) をsystemdで起動して、仮想SIMが接続された状態で行います。
プログラム起動時に `iot-epd-signage/started` へメッセージをPublishし、`iot-epd-signage/schedule` をSubscribeすることで、イベント情報を受信します。

![](通信の図)

### クラウド

#### AWSリソース

#### プログラム

## 動作確認

## よくある質問

## まとめ
